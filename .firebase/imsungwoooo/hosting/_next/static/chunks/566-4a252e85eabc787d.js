"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[566],{1332:(t,e,i)=>{i.d(e,{d:()=>c});var s=i(9630),r=i(2115),a=i(3264),o=i(2732);let n=parseInt(a.sPf.replace(/\D+/g,""));class h extends a.BKk{constructor(t=new a.I9Y){super({uniforms:{inputBuffer:new a.nc$(null),depthBuffer:new a.nc$(null),resolution:new a.nc$(new a.I9Y),texelSize:new a.nc$(new a.I9Y),halfTexelSize:new a.nc$(new a.I9Y),kernel:new a.nc$(0),scale:new a.nc$(1),cameraNear:new a.nc$(0),cameraFar:new a.nc$(1),minDepthThreshold:new a.nc$(0),maxDepthThreshold:new a.nc$(1),depthScale:new a.nc$(0),depthToBlurRatioBias:new a.nc$(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${n>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:a.XIg,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(t.x,t.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e),this.uniforms.halfTexelSize.value.set(t,e).multiplyScalar(.5)}setResolution(t){this.uniforms.resolution.value.copy(t)}}class l{constructor({gl:t,resolution:e,width:i=500,height:s=500,minDepthThreshold:r=0,maxDepthThreshold:o=1,depthScale:n=0,depthToBlurRatioBias:l=.25}){this.renderToScreen=!1,this.renderTargetA=new a.nWS(e,e,{minFilter:a.k6q,magFilter:a.k6q,stencilBuffer:!1,depthBuffer:!1,type:a.ix0}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new h,this.convolutionMaterial.setTexelSize(1/i,1/s),this.convolutionMaterial.setResolution(new a.I9Y(i,s)),this.scene=new a.Z58,this.camera=new a.i7d,this.convolutionMaterial.uniforms.minDepthThreshold.value=r,this.convolutionMaterial.uniforms.maxDepthThreshold.value=o,this.convolutionMaterial.uniforms.depthScale.value=n,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=l,this.convolutionMaterial.defines.USE_DEPTH=n>0;let _=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),c=new Float32Array([0,0,2,0,0,2]),d=new a.LoY;d.setAttribute("position",new a.THS(_,3)),d.setAttribute("uv",new a.THS(c,2)),this.screen=new a.eaF(d,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(t,e,i){let s,r,a;let o=this.scene,n=this.camera,h=this.renderTargetA,l=this.renderTargetB,_=this.convolutionMaterial,c=_.uniforms;c.depthBuffer.value=e.depthTexture;let d=_.kernel,m=e;for(r=0,a=d.length-1;r<a;++r)s=(1&r)==0?h:l,c.kernel.value=d[r],c.inputBuffer.value=m.texture,t.setRenderTarget(s),t.render(o,n),m=s;c.kernel.value=d[r],c.inputBuffer.value=m.texture,t.setRenderTarget(this.renderToScreen?null:i),t.render(o,n)}}class _ extends a._4j{constructor(t={}){super(t),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(t)}onBeforeCompile(t){var e;null!=(e=t.defines)&&e.USE_UV||(t.defines.USE_UV=""),t.uniforms.hasBlur=this._hasBlur,t.uniforms.tDiffuse=this._tDiffuse,t.uniforms.tDepth=this._tDepth,t.uniforms.distortionMap=this._distortionMap,t.uniforms.tDiffuseBlur=this._tDiffuseBlur,t.uniforms.textureMatrix=this._textureMatrix,t.uniforms.mirror=this._mirror,t.uniforms.mixBlur=this._mixBlur,t.uniforms.mixStrength=this._blurStrength,t.uniforms.minDepthThreshold=this._minDepthThreshold,t.uniforms.maxDepthThreshold=this._maxDepthThreshold,t.uniforms.depthScale=this._depthScale,t.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,t.uniforms.distortion=this._distortion,t.uniforms.mixContrast=this._mixContrast,t.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${t.vertexShader}`,t.vertexShader=t.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),t.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${t.fragmentShader}`,t.fragmentShader=t.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(t){this._tDiffuse.value=t}get tDepth(){return this._tDepth.value}set tDepth(t){this._tDepth.value=t}get distortionMap(){return this._distortionMap.value}set distortionMap(t){this._distortionMap.value=t}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(t){this._tDiffuseBlur.value=t}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(t){this._textureMatrix.value=t}get hasBlur(){return this._hasBlur.value}set hasBlur(t){this._hasBlur.value=t}get mirror(){return this._mirror.value}set mirror(t){this._mirror.value=t}get mixBlur(){return this._mixBlur.value}set mixBlur(t){this._mixBlur.value=t}get mixStrength(){return this._blurStrength.value}set mixStrength(t){this._blurStrength.value=t}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(t){this._minDepthThreshold.value=t}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(t){this._maxDepthThreshold.value=t}get depthScale(){return this._depthScale.value}set depthScale(t){this._depthScale.value=t}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(t){this._depthToBlurRatioBias.value=t}get distortion(){return this._distortion.value}set distortion(t){this._distortion.value=t}get mixContrast(){return this._mixContrast.value}set mixContrast(t){this._mixContrast.value=t}}let c=r.forwardRef(({mixBlur:t=0,mixStrength:e=1,resolution:i=256,blur:n=[0,0],minDepthThreshold:h=.9,maxDepthThreshold:c=1,depthScale:d=0,depthToBlurRatioBias:m=.25,mirror:u=0,distortion:p=1,mixContrast:f=1,distortionMap:v,reflectorOffset:T=0,...g},E)=>{(0,o.e)({MeshReflectorMaterialImpl:_});let O=(0,o.A)(({gl:t})=>t),y=(0,o.A)(({camera:t})=>t),x=(0,o.A)(({scene:t})=>t),C=(n=Array.isArray(n)?n:[n,n])[0]+n[1]>0,U=r.useRef(null);r.useImperativeHandle(E,()=>U.current,[]);let[D]=r.useState(()=>new a.Zcv),[S]=r.useState(()=>new a.Pq0),[A]=r.useState(()=>new a.Pq0),[L]=r.useState(()=>new a.Pq0),[R]=r.useState(()=>new a.kn4),[w]=r.useState(()=>new a.Pq0(0,0,-1)),[P]=r.useState(()=>new a.IUQ),[M]=r.useState(()=>new a.Pq0),[F]=r.useState(()=>new a.Pq0),[z]=r.useState(()=>new a.IUQ),[b]=r.useState(()=>new a.kn4),[H]=r.useState(()=>new a.ubm),N=r.useCallback(()=>{var t;let e=U.current.parent||(null==(t=U.current)||null==(t=t.__r3f.parent)?void 0:t.object);if(!e||(A.setFromMatrixPosition(e.matrixWorld),L.setFromMatrixPosition(y.matrixWorld),R.extractRotation(e.matrixWorld),S.set(0,0,1),S.applyMatrix4(R),A.addScaledVector(S,T),M.subVectors(A,L),M.dot(S)>0))return;M.reflect(S).negate(),M.add(A),R.extractRotation(y.matrixWorld),w.set(0,0,-1),w.applyMatrix4(R),w.add(L),F.subVectors(A,w),F.reflect(S).negate(),F.add(A),H.position.copy(M),H.up.set(0,1,0),H.up.applyMatrix4(R),H.up.reflect(S),H.lookAt(F),H.far=y.far,H.updateMatrixWorld(),H.projectionMatrix.copy(y.projectionMatrix),b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(H.projectionMatrix),b.multiply(H.matrixWorldInverse),b.multiply(e.matrixWorld),D.setFromNormalAndCoplanarPoint(S,A),D.applyMatrix4(H.matrixWorldInverse),P.set(D.normal.x,D.normal.y,D.normal.z,D.constant);let i=H.projectionMatrix;z.x=(Math.sign(P.x)+i.elements[8])/i.elements[0],z.y=(Math.sign(P.y)+i.elements[9])/i.elements[5],z.z=-1,z.w=(1+i.elements[10])/i.elements[14],P.multiplyScalar(2/P.dot(z)),i.elements[2]=P.x,i.elements[6]=P.y,i.elements[10]=P.z+1,i.elements[14]=P.w},[y,T]),[B,k,V,Y]=r.useMemo(()=>{let s={minFilter:a.k6q,magFilter:a.k6q,type:a.ix0},r=new a.nWS(i,i,s);r.depthBuffer=!0,r.depthTexture=new a.VCu(i,i),r.depthTexture.format=a.zdS,r.depthTexture.type=a.cHt;let o=new a.nWS(i,i,s),_=new l({gl:O,resolution:i,width:n[0],height:n[1],minDepthThreshold:h,maxDepthThreshold:c,depthScale:d,depthToBlurRatioBias:m}),T={mirror:u,textureMatrix:b,mixBlur:t,tDiffuse:r.texture,tDepth:r.depthTexture,tDiffuseBlur:o.texture,hasBlur:C,mixStrength:e,minDepthThreshold:h,maxDepthThreshold:c,depthScale:d,depthToBlurRatioBias:m,distortion:p,distortionMap:v,mixContrast:f,"defines-USE_BLUR":C?"":void 0,"defines-USE_DEPTH":d>0?"":void 0,"defines-USE_DISTORTION":v?"":void 0};return[r,o,_,T]},[O,n,b,i,u,C,t,e,h,c,d,m,p,v,f]);return(0,o.C)(()=>{var t;let e=U.current.parent||(null==(t=U.current)||null==(t=t.__r3f.parent)?void 0:t.object);if(!e)return;e.visible=!1;let i=O.xr.enabled,s=O.shadowMap.autoUpdate;N(),O.xr.enabled=!1,O.shadowMap.autoUpdate=!1,O.setRenderTarget(B),O.state.buffers.depth.setMask(!0),O.autoClear||O.clear(),O.render(x,H),C&&V.render(O,B,k),O.xr.enabled=i,O.shadowMap.autoUpdate=s,e.visible=!0,O.setRenderTarget(null)}),r.createElement("meshReflectorMaterialImpl",(0,s.A)({attach:"material",key:"key"+Y["defines-USE_BLUR"]+Y["defines-USE_DEPTH"]+Y["defines-USE_DISTORTION"],ref:U},Y,g))})},2660:(t,e,i)=>{i.d(e,{zo:()=>n});var s=i(2115),r=i(3264),a=i(2732);let o=t=>t===Object(t)&&!Array.isArray(t)&&"function"!=typeof t;function n(t,e){let i=(0,a.A)(t=>t.gl),n=(0,a.F)(r.Tap,o(t)?Object.values(t):t);return(0,s.useLayoutEffect)(()=>{null==e||e(n)},[e]),(0,s.useEffect)(()=>{if("initTexture"in i){let t=[];Array.isArray(n)?t=n:n instanceof r.gPd?t=[n]:o(n)&&(t=Object.values(n)),t.forEach(t=>{t instanceof r.gPd&&i.initTexture(t)})}},[i,n]),(0,s.useMemo)(()=>{if(!o(t))return n;{let e={},i=0;for(let s in t)e[s]=n[i++];return e}},[t,n])}n.preload=t=>a.F.preload(r.Tap,t),n.clear=t=>a.F.clear(r.Tap,t)},5521:(t,e,i)=>{i.d(e,{v:()=>n});var s=i(2115),r=i(2421);let a=t=>t,o=t=>{let e=(0,r.y)(t),i=t=>(function(t,e=a){let i=s.useSyncExternalStore(t.subscribe,()=>e(t.getState()),()=>e(t.getInitialState()));return s.useDebugValue(i),i})(e,t);return Object.assign(i,e),i},n=t=>t?o(t):o},9630:(t,e,i)=>{i.d(e,{A:()=>s});function s(){return(s=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)({}).hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(null,arguments)}},9958:(t,e,i)=>{let s,r,a,o,n,h,l,_,c,d,m,u,p,f,v,T,g,E,O,y,x,C,U;i.d(e,{a:()=>J});var D,S=i(9630),A=i(3264),L=i(2115),R=i(2732);let w={LEFT:1,RIGHT:2,MIDDLE:4},P=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),M={NONE:0,IN:1,OUT:-1};function F(t){return t.isPerspectiveCamera}function z(t){return t.isOrthographicCamera}let b=2*Math.PI,H=Math.PI/2,N=Math.PI/180;function B(t,e,i){return Math.max(e,Math.min(i,t))}function k(t,e=1e-5){return Math.abs(t)<e}function V(t,e,i=1e-5){return k(t-e,i)}function Y(t,e){return Math.round(t/e)*e}function I(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Z(t){return Math.abs(t)<Number.MAX_VALUE?t:1/0*t}function K(t,e,i,s,r=1/0,a){let o=2/(s=Math.max(1e-4,s)),n=o*a,h=1/(1+n+.48*n*n+.235*n*n*n),l=t-e,_=e,c=r*s;e=t-(l=B(l,-c,c));let d=(i.value+o*l)*a;i.value=(i.value-o*d)*h;let m=e+(l+d)*h;return _-t>0==m>_&&(i.value=((m=_)-_)/a),m}function j(t,e,i,s,r=1/0,a,o){let n=2/(s=Math.max(1e-4,s)),h=n*a,l=1/(1+h+.48*h*h+.235*h*h*h),_=e.x,c=e.y,d=e.z,m=t.x-_,u=t.y-c,p=t.z-d,f=_,v=c,T=d,g=r*s,E=m*m+u*u+p*p;if(E>g*g){let t=Math.sqrt(E);m=m/t*g,u=u/t*g,p=p/t*g}_=t.x-m,c=t.y-u,d=t.z-p;let O=(i.x+n*m)*a,y=(i.y+n*u)*a,x=(i.z+n*p)*a;i.x=(i.x-n*O)*l,i.y=(i.y-n*y)*l,i.z=(i.z-n*x)*l,o.x=_+(m+O)*l,o.y=c+(u+y)*l,o.z=d+(p+x)*l;let C=f-t.x,U=v-t.y,D=T-t.z,S=o.x-f;return C*S+U*(o.y-v)+D*(o.z-T)>0&&(o.x=f,o.y=v,o.z=T,i.x=(o.x-f)/a,i.y=(o.y-v)/a,i.z=(o.z-T)/a),o}function X(t,e){e.set(0,0),t.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=t.length,e.y/=t.length}function Q(t,e){return!!z(t)&&(console.warn(`${e} is not supported in OrthographicCamera`),!0)}class q{constructor(){this._listeners={}}addEventListener(t,e){let i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){let i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){let i=this._listeners[t];if(void 0!==i){let t=i.indexOf(e);-1!==t&&i.splice(t,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){let e=this._listeners[t.type];if(void 0!==e){t.target=this;let i=e.slice(0);for(let e=0,s=i.length;e<s;e++)i[e].call(this,t)}}}let W=1/8,$=/Mac/.test(null===(D=null==globalThis?void 0:globalThis.navigator)||void 0===D?void 0:D.platform);class G extends q{static install(t){r=Object.freeze(new(s=t.THREE).Vector3(0,0,0)),a=Object.freeze(new s.Vector3(0,1,0)),o=Object.freeze(new s.Vector3(0,0,1)),n=new s.Vector2,h=new s.Vector3,l=new s.Vector3,_=new s.Vector3,c=new s.Vector3,d=new s.Vector3,m=new s.Vector3,u=new s.Vector3,p=new s.Vector3,f=new s.Vector3,v=new s.Spherical,T=new s.Spherical,g=new s.Box3,E=new s.Box3,O=new s.Sphere,y=new s.Quaternion,x=new s.Quaternion,C=new s.Matrix4,U=new s.Raycaster}static get ACTION(){return P}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=P.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=M.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new s.Vector3,this._focalOffsetVelocity=new s.Vector3,this._zoomVelocity={value:0},this._truckInternal=(t,e,i,s)=>{let r,a;if(F(this._camera)){let i=h.copy(this._camera.position).sub(this._target),s=this._camera.getEffectiveFOV()*N,o=i.length()*Math.tan(.5*s);r=this.truckSpeed*t*o/this._elementRect.height,a=this.truckSpeed*e*o/this._elementRect.height}else{if(!z(this._camera))return;let i=this._camera;r=this.truckSpeed*t*(i.right-i.left)/i.zoom/this._elementRect.width,a=this.truckSpeed*e*(i.top-i.bottom)/i.zoom/this._elementRect.height}s?(i?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(r,0,!0),this.forward(-a,!0)):i?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y+a,this._focalOffsetEnd.z,!0):this.truck(r,a,!0)},this._rotateInternal=(t,e)=>{let i=b*this.azimuthRotateSpeed*t/this._elementRect.height,s=b*this.polarRotateSpeed*e/this._elementRect.height;this.rotate(i,s,!0)},this._dollyInternal=(t,e,i)=>{let s=Math.pow(.95,-t*this.dollySpeed),r=this._sphericalEnd.radius,a=this._sphericalEnd.radius*s,o=B(a,this.minDistance,this.maxDistance);this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(a,!0):(this.infinityDolly&&!this.dollyToCursor&&this.dollyInFixed(o-a,!0),this._dollyToNoClamp(o,!0)),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?a:o)-r,this._dollyControlCoord.set(e,i)),this._lastDollyDirection=Math.sign(-t)},this._zoomInternal=(t,e,i)=>{let s=Math.pow(.95,t*this.dollySpeed),r=this._zoom,a=this._zoom*s;this.zoomTo(a,!0),this.dollyToCursor&&(this._changedZoom+=a-r,this._dollyControlCoord.set(e,i))},void 0===s&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new s.Quaternion().setFromUnitVectors(this._camera.up,a),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=P.NONE,this._target=new s.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new s.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new s.Spherical().setFromVector3(h.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3],this._updateNearPlaneCorners(),this._boundary=new s.Box3(new s.Vector3(-1/0,-1/0,-1/0),new s.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new s.Vector2,this.mouseButtons={left:P.ROTATE,middle:P.DOLLY,right:P.TRUCK,wheel:F(this._camera)?P.DOLLY:z(this._camera)?P.ZOOM:P.NONE},this.touches={one:P.TOUCH_ROTATE,two:F(this._camera)?P.TOUCH_DOLLY_TRUCK:z(this._camera)?P.TOUCH_ZOOM_TRUCK:P.NONE,three:P.TOUCH_TRUCK};let i=new s.Vector2,r=new s.Vector2,o=new s.Vector2,l=t=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let e=this._domElement.getBoundingClientRect(),i=t.clientX/e.width,s=t.clientY/e.height;if(i<this._interactiveArea.left||i>this._interactiveArea.right||s<this._interactiveArea.top||s>this._interactiveArea.bottom)return}let e="mouse"!==t.pointerType?null:(t.buttons&w.LEFT)===w.LEFT?w.LEFT:(t.buttons&w.MIDDLE)===w.MIDDLE?w.MIDDLE:(t.buttons&w.RIGHT)===w.RIGHT?w.RIGHT:null;if(null!==e){let t=this._findPointerByMouseButton(e);t&&this._disposePointer(t)}if((t.buttons&w.LEFT)===w.LEFT&&this._lockedPointer)return;let i={pointerId:t.pointerId,clientX:t.clientX,clientY:t.clientY,deltaX:0,deltaY:0,mouseButton:e};this._activePointers.push(i),this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,p(t)},_=t=>{t.cancelable&&t.preventDefault();let e=t.pointerId,i=this._lockedPointer||this._findPointerById(e);if(i){if(i.clientX=t.clientX,i.clientY=t.clientY,i.deltaX=t.movementX,i.deltaY=t.movementY,this._state=0,"touch"===t.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(t.buttons&w.LEFT)===w.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(t.buttons&w.MIDDLE)===w.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(t.buttons&w.RIGHT)===w.RIGHT&&(this._state=this._state|this.mouseButtons.right);f()}},c=t=>{let e=this._findPointerById(t.pointerId);if(!e||e!==this._lockedPointer){if(e&&this._disposePointer(e),"touch"===t.pointerType)switch(this._activePointers.length){case 0:this._state=P.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=P.NONE;v()}},d=-1,m=t=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===P.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let e=this._domElement.getBoundingClientRect(),i=t.clientX/e.width,s=t.clientY/e.height;if(i<this._interactiveArea.left||i>this._interactiveArea.right||s<this._interactiveArea.top||s>this._interactiveArea.bottom)return}if(t.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===P.ROTATE||this.mouseButtons.wheel===P.TRUCK){let t=performance.now();d-t<1e3&&this._getClientRect(this._elementRect),d=t}let e=$?-1:-3,i=1===t.deltaMode?t.deltaY/e:t.deltaY/(10*e),s=this.dollyToCursor?(t.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,r=this.dollyToCursor?-((t.clientY-this._elementRect.y)/this._elementRect.height*2)+1:0;switch(this.mouseButtons.wheel){case P.ROTATE:this._rotateInternal(t.deltaX,t.deltaY),this._isUserControllingRotate=!0;break;case P.TRUCK:this._truckInternal(t.deltaX,t.deltaY,!1,!1),this._isUserControllingTruck=!0;break;case P.SCREEN_PAN:this._truckInternal(t.deltaX,t.deltaY,!1,!0),this._isUserControllingTruck=!0;break;case P.OFFSET:this._truckInternal(t.deltaX,t.deltaY,!0,!1),this._isUserControllingOffset=!0;break;case P.DOLLY:this._dollyInternal(-i,s,r),this._isUserControllingDolly=!0;break;case P.ZOOM:this._zoomInternal(-i,s,r),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},u=t=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===G.ACTION.NONE){let e=t instanceof PointerEvent?t.pointerId:0,i=this._findPointerById(e);i&&this._disposePointer(i),this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}t.preventDefault()}},p=t=>{if(this._enabled){if(X(this._activePointers,n),this._getClientRect(this._elementRect),i.copy(n),r.copy(n),this._activePointers.length>=2){let t=n.x-this._activePointers[1].clientX,e=n.y-this._activePointers[1].clientY,i=Math.sqrt(t*t+e*e);o.set(0,i);let s=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,a=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(s,a)}if(this._state=0,t){if("pointerType"in t&&"touch"===t.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(t.buttons&w.LEFT)!==w.LEFT||(this._state=this._state|this.mouseButtons.left),(t.buttons&w.MIDDLE)===w.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(t.buttons&w.RIGHT)===w.RIGHT&&(this._state=this._state|this.mouseButtons.right)}else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);((this._state&P.ROTATE)===P.ROTATE||(this._state&P.TOUCH_ROTATE)===P.TOUCH_ROTATE||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&P.TRUCK)===P.TRUCK||(this._state&P.SCREEN_PAN)===P.SCREEN_PAN||(this._state&P.TOUCH_TRUCK)===P.TOUCH_TRUCK||(this._state&P.TOUCH_SCREEN_PAN)===P.TOUCH_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&P.DOLLY)===P.DOLLY||(this._state&P.TOUCH_DOLLY)===P.TOUCH_DOLLY||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&P.ZOOM)===P.ZOOM||(this._state&P.TOUCH_ZOOM)===P.TOUCH_ZOOM||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_ZOOM_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&P.OFFSET)===P.OFFSET||(this._state&P.TOUCH_OFFSET)===P.TOUCH_OFFSET||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},f=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,X(this._activePointers,n);let t=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,e=t?-t.deltaX:r.x-n.x,s=t?-t.deltaY:r.y-n.y;if(r.copy(n),((this._state&P.ROTATE)===P.ROTATE||(this._state&P.TOUCH_ROTATE)===P.TOUCH_ROTATE||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(e,s),this._isUserControllingRotate=!0),(this._state&P.DOLLY)===P.DOLLY||(this._state&P.ZOOM)===P.ZOOM){let t=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,e=this.dollyToCursor?-((i.y-this._elementRect.y)/this._elementRect.height*2)+1:0,r=this.dollyDragInverted?-1:1;(this._state&P.DOLLY)===P.DOLLY?(this._dollyInternal(r*s*W,t,e),this._isUserControllingDolly=!0):(this._zoomInternal(r*s*W,t,e),this._isUserControllingZoom=!0)}if((this._state&P.TOUCH_DOLLY)===P.TOUCH_DOLLY||(this._state&P.TOUCH_ZOOM)===P.TOUCH_ZOOM||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_ZOOM_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_ZOOM_ROTATE)===P.TOUCH_ZOOM_ROTATE){let t=n.x-this._activePointers[1].clientX,e=n.y-this._activePointers[1].clientY,i=Math.sqrt(t*t+e*e),s=o.y-i;o.set(0,i);let a=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,h=this.dollyToCursor?-((r.y-this._elementRect.y)/this._elementRect.height*2)+1:0;(this._state&P.TOUCH_DOLLY)===P.TOUCH_DOLLY||(this._state&P.TOUCH_DOLLY_ROTATE)===P.TOUCH_DOLLY_ROTATE||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET?(this._dollyInternal(s*W,a,h),this._isUserControllingDolly=!0):(this._zoomInternal(s*W,a,h),this._isUserControllingZoom=!0)}((this._state&P.TRUCK)===P.TRUCK||(this._state&P.TOUCH_TRUCK)===P.TOUCH_TRUCK||(this._state&P.TOUCH_DOLLY_TRUCK)===P.TOUCH_DOLLY_TRUCK||(this._state&P.TOUCH_ZOOM_TRUCK)===P.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(e,s,!1,!1),this._isUserControllingTruck=!0),((this._state&P.SCREEN_PAN)===P.SCREEN_PAN||(this._state&P.TOUCH_SCREEN_PAN)===P.TOUCH_SCREEN_PAN||(this._state&P.TOUCH_DOLLY_SCREEN_PAN)===P.TOUCH_DOLLY_SCREEN_PAN||(this._state&P.TOUCH_ZOOM_SCREEN_PAN)===P.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(e,s,!1,!0),this._isUserControllingTruck=!0),((this._state&P.OFFSET)===P.OFFSET||(this._state&P.TOUCH_OFFSET)===P.TOUCH_OFFSET||(this._state&P.TOUCH_DOLLY_OFFSET)===P.TOUCH_DOLLY_OFFSET||(this._state&P.TOUCH_ZOOM_OFFSET)===P.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(e,s,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},v=()=>{X(this._activePointers,n),r.copy(n),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",T),this._domElement.ownerDocument.addEventListener("pointerlockerror",g),this._domElement.ownerDocument.addEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),p())},this.unlockPointer=()=>{var t,e,i;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null===(t=this._domElement)||void 0===t||t.ownerDocument.exitPointerLock(),null===(e=this._domElement)||void 0===e||e.ownerDocument.removeEventListener("pointerlockchange",T),null===(i=this._domElement)||void 0===i||i.ownerDocument.removeEventListener("pointerlockerror",g),this.cancel()};let T=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},g=()=>{this.unlockPointer()};this._addAllEventListeners=t=>{this._domElement=t,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",l),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",m,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",l),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",m,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",_,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",T),this._domElement.ownerDocument.removeEventListener("pointerlockerror",g))},this.cancel=()=>{this._state!==P.NONE&&(this._state=P.NONE,this._activePointers.length=0,v())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){(this._spherical.radius!==t||this._sphericalEnd.radius!==t)&&(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){(this._spherical.theta!==t||this._sphericalEnd.theta!==t)&&(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){(this._spherical.phi!==t||this._sphericalEnd.phi!==t)&&(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=B(t.width,0,1),this._interactiveArea.height=B(t.height,0,1),this._interactiveArea.x=B(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=B(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,i=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,i=!1){this._isUserControllingRotate=!1;let s=B(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=B(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=s,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let a=!i||V(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&V(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=M.NONE,this._changedDolly=0,this._dollyToNoClamp(B(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){let i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){let e=this._collisionTest(),s=V(e,this._spherical.radius);if(!(i>t)&&s)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,e)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);let s=!e||V(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(c).multiplyScalar(t)),e||this._target.copy(this._targetEnd);let i=!e||V(this._target.x,this._targetEnd.x,this.restThreshold)&&V(this._target.y,this._targetEnd.y,this.restThreshold)&&V(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=B(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);let i=!e||V(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(t,e,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,i)}truck(t,e,i=!1){this._camera.updateMatrix(),d.setFromMatrixColumn(this._camera.matrix,0),m.setFromMatrixColumn(this._camera.matrix,1),d.multiplyScalar(t),m.multiplyScalar(-e);let s=h.copy(d).add(m),r=l.copy(this._targetEnd).add(s);return this.moveTo(r.x,r.y,r.z,i)}forward(t,e=!1){h.setFromMatrixColumn(this._camera.matrix,0),h.crossVectors(this._camera.up,h),h.multiplyScalar(t);let i=l.copy(this._targetEnd).add(h);return this.moveTo(i.x,i.y,i.z,e)}elevate(t,e=!1){return h.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+h.x,this._targetEnd.y+h.y,this._targetEnd.z+h.z,e)}moveTo(t,e,i,s=!1){this._isUserControllingTruck=!1;let r=h.set(t,e,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,s||this._target.copy(this._targetEnd);let a=!s||V(this._target.x,this._targetEnd.x,this.restThreshold)&&V(this._target.y,this._targetEnd.y,this.restThreshold)&&V(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(t,e,i,s=!1){let r=h.set(t,e,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,s)}fitToBox(t,e,{cover:i=!1,paddingLeft:s=0,paddingRight:r=0,paddingBottom:n=0,paddingTop:_=0}={}){let c=[],d=t.isBox3?g.copy(t):g.setFromObject(t);d.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let m=Y(this._sphericalEnd.theta,H),u=Y(this._sphericalEnd.phi,H);c.push(this.rotateTo(m,u,e));let p=h.setFromSpherical(this._sphericalEnd).normalize(),f=y.setFromUnitVectors(p,o),v=V(Math.abs(p.y),1);v&&f.multiply(x.setFromAxisAngle(a,m)),f.multiply(this._yAxisUpSpaceInverse);let T=E.makeEmpty();l.copy(d.min).applyQuaternion(f),T.expandByPoint(l),l.copy(d.min).setX(d.max.x).applyQuaternion(f),T.expandByPoint(l),l.copy(d.min).setY(d.max.y).applyQuaternion(f),T.expandByPoint(l),l.copy(d.max).setZ(d.min.z).applyQuaternion(f),T.expandByPoint(l),l.copy(d.min).setZ(d.max.z).applyQuaternion(f),T.expandByPoint(l),l.copy(d.max).setY(d.min.y).applyQuaternion(f),T.expandByPoint(l),l.copy(d.max).setX(d.min.x).applyQuaternion(f),T.expandByPoint(l),l.copy(d.max).applyQuaternion(f),T.expandByPoint(l),T.min.x-=s,T.min.y-=n,T.max.x+=r,T.max.y+=_,f.setFromUnitVectors(o,p),v&&f.premultiply(x.invert()),f.premultiply(this._yAxisUpSpace);let O=T.getSize(h),C=T.getCenter(l).applyQuaternion(f);if(F(this._camera)){let t=this.getDistanceToFitBox(O.x,O.y,O.z,i);c.push(this.moveTo(C.x,C.y,C.z,e)),c.push(this.dollyTo(t,e)),c.push(this.setFocalOffset(0,0,0,e))}else if(z(this._camera)){let t=this._camera,s=t.right-t.left,r=t.top-t.bottom,a=i?Math.max(s/O.x,r/O.y):Math.min(s/O.x,r/O.y);c.push(this.moveTo(C.x,C.y,C.z,e)),c.push(this.zoomTo(a,e)),c.push(this.setFocalOffset(0,0,0,e))}return Promise.all(c)}fitToSphere(t,e){let i=[],s="isObject3D"in t?G.createBoundingSphere(t,O):O.copy(t);if(i.push(this.moveTo(s.center.x,s.center.y,s.center.z,e)),F(this._camera)){let t=this.getDistanceToFitSphere(s.radius);i.push(this.dollyTo(t,e))}else if(z(this._camera)){let t=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,a=2*s.radius,o=Math.min(t/a,r/a);i.push(this.zoomTo(o,e))}return i.push(this.setFocalOffset(0,0,0,e)),Promise.all(i)}setLookAt(t,e,i,s,r,a,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=M.NONE,this._changedDolly=0;let n=l.set(s,r,a),_=h.set(t,e,i);this._targetEnd.copy(n),this._sphericalEnd.setFromVector3(_.sub(n).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let c=!o||V(this._target.x,this._targetEnd.x,this.restThreshold)&&V(this._target.y,this._targetEnd.y,this.restThreshold)&&V(this._target.z,this._targetEnd.z,this.restThreshold)&&V(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&V(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&V(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(t,e,i,s,r,a,o,n,c,d,m,u,p,f=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=M.NONE,this._changedDolly=0;let g=h.set(s,r,a),E=l.set(t,e,i);v.setFromVector3(E.sub(g).applyQuaternion(this._yAxisUpSpace));let O=_.set(d,m,u),y=l.set(o,n,c);T.setFromVector3(y.sub(O).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(g.lerp(O,p));let x=T.theta-v.theta,C=T.phi-v.phi,U=T.radius-v.radius;this._sphericalEnd.set(v.radius+U*p,v.phi+C*p,v.theta+x*p),this.normalizeRotations(),this._needsUpdate=!0,f||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let D=!f||V(this._target.x,this._targetEnd.x,this.restThreshold)&&V(this._target.y,this._targetEnd.y,this.restThreshold)&&V(this._target.z,this._targetEnd.z,this.restThreshold)&&V(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&V(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&V(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(D)}setPosition(t,e,i,s=!1){return this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,s)}setTarget(t,e,i,s=!1){let r=this.getPosition(h),a=this.setLookAt(r.x,r.y,r.z,t,e,i,s);return this._sphericalEnd.phi=B(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(t,e,i,s=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,i),this._needsUpdate=!0,s||this._focalOffset.copy(this._focalOffsetEnd);let r=!s||V(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&V(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&V(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,i){this._camera.updateMatrixWorld(),d.setFromMatrixColumn(this._camera.matrixWorldInverse,0),m.setFromMatrixColumn(this._camera.matrixWorldInverse,1),u.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let s=h.set(t,e,i),r=s.distanceTo(this._camera.position),a=s.sub(this._camera.position);d.multiplyScalar(a.x),m.multiplyScalar(a.y),u.multiplyScalar(a.z),h.copy(d).add(m).add(u),h.z=h.z+r,this.dollyTo(r,!1),this.setFocalOffset(-h.x,h.y,-h.z,!1),this.moveTo(t,e,i,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,i,r){if(null===t){this._viewport=null;return}this._viewport=this._viewport||new s.Vector4,"number"==typeof t?this._viewport.set(t,e,i,r):this._viewport.copy(t)}getDistanceToFitBox(t,e,i,s=!1){if(Q(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let r=t/e,a=this._camera.getEffectiveFOV()*N,o=this._camera.aspect;return .5*((s?r>o:r<o)?e:t/o)/Math.tan(.5*a)+.5*i}getDistanceToFitSphere(t){if(Q(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let e=this._camera.getEffectiveFOV()*N,i=2*Math.atan(Math.tan(.5*e)*this._camera.aspect);return t/Math.sin(.5*(1<this._camera.aspect?e:i))}getTarget(t,e=!0){return(t&&t.isVector3?t:new s.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new s.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new s.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new s.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%b,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=b),this._spherical.theta+=b*Math.round((this._sphericalEnd.theta-this._spherical.theta)/b)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!V(this._camera.up.x,this._cameraUp0.x)||!V(this._camera.up.y,this._cameraUp0.y)||!V(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let t=this.getPosition(h);this.updateCameraUp(),this.setPosition(t.x,t.y,t.z)}return Promise.all([this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)])}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,a),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let t=h.subVectors(this._target,this._camera.position).normalize(),e=l.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();let i=this.getPosition(h);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(t){let e=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,s=this._sphericalEnd.radius-this._spherical.radius,r=p.subVectors(this._targetEnd,this._target),a=f.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(k(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let e=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=K(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,e,1/0,t),this._needsUpdate=!0}if(k(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let e=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=K(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,e,1/0,t),this._needsUpdate=!0}if(k(s))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let e=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=K(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,e,this.maxSpeed,t),this._needsUpdate=!0}if(k(r.x)&&k(r.y)&&k(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let e=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;j(this._target,this._targetEnd,this._targetVelocity,e,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(k(a.x)&&k(a.y)&&k(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let e=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;j(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,e,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(k(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let e=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=K(this._zoom,this._zoomEnd,this._zoomVelocity,e,1/0,t)}if(this.dollyToCursor){if(F(this._camera)&&0!==this._changedDolly){let t=this._spherical.radius-this._lastDistance,e=this._camera,i=this._getCameraDirection(c),s=h.copy(i).cross(e.up).normalize();0===s.lengthSq()&&(s.x=1);let r=l.crossVectors(s,i),a=this._sphericalEnd.radius*Math.tan(e.getEffectiveFOV()*N*.5),o=(this._sphericalEnd.radius-t-this._sphericalEnd.radius)/this._sphericalEnd.radius,n=_.copy(this._targetEnd).add(s.multiplyScalar(this._dollyControlCoord.x*a*e.aspect)).add(r.multiplyScalar(this._dollyControlCoord.y*a)),d=h.copy(this._targetEnd).lerp(n,o),m=this._lastDollyDirection===M.IN&&this._spherical.radius<=this.minDistance,u=this._lastDollyDirection===M.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(m||u)){this._sphericalEnd.radius-=t,this._spherical.radius-=t;let e=l.copy(i).multiplyScalar(-t);d.add(e)}this._boundary.clampPoint(d,d);let p=l.subVectors(d,this._targetEnd);this._targetEnd.copy(d),this._target.add(p),this._changedDolly-=t,k(this._changedDolly)&&(this._changedDolly=0)}else if(z(this._camera)&&0!==this._changedZoom){let t=this._zoom-this._lastZoom,e=this._camera,i=h.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(e.near+e.far)/(e.near-e.far)).unproject(e),s=l.set(0,0,-1).applyQuaternion(e.quaternion),r=_.copy(i).add(s.multiplyScalar(-i.dot(e.up))),a=-(this._zoom-t-this._zoom)/this._zoom,o=this._getCameraDirection(c),n=this._targetEnd.dot(o),d=h.copy(this._targetEnd).lerp(r,a),m=d.dot(o),u=o.multiplyScalar(m-n);d.sub(u),this._boundary.clampPoint(d,d);let p=l.subVectors(d,this._targetEnd);this._targetEnd.copy(d),this._target.add(p),this._changedZoom-=t,k(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;let n=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,n),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),k(this._focalOffset.x)&&k(this._focalOffset.y)&&k(this._focalOffset.z)||(d.setFromMatrixColumn(this._camera.matrix,0),m.setFromMatrixColumn(this._camera.matrix,1),u.setFromMatrixColumn(this._camera.matrix,2),d.multiplyScalar(this._focalOffset.x),m.multiplyScalar(-this._focalOffset.y),u.multiplyScalar(this._focalOffset.z),h.copy(d).add(m).add(u),this._camera.position.add(h),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),h.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let v=this._needsUpdate;return v&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):v?(this.dispatchEvent({type:"update"}),k(e,this.restThreshold)&&k(i,this.restThreshold)&&k(s,this.restThreshold)&&k(r.x,this.restThreshold)&&k(r.y,this.restThreshold)&&k(r.z,this.restThreshold)&&k(a.x,this.restThreshold)&&k(a.y,this.restThreshold)&&k(a.z,this.restThreshold)&&k(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!v&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=v,this._needsUpdate=!1,v}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:I(this.maxDistance),minZoom:this.minZoom,maxZoom:I(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:I(this.maxPolarAngle),minAzimuthAngle:I(this.minAzimuthAngle),maxAzimuthAngle:I(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:h.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){let i=JSON.parse(t);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=Z(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=Z(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=Z(i.maxPolarAngle),this.minAzimuthAngle=Z(i.minAzimuthAngle),this.maxAzimuthAngle=Z(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],e),v.setFromVector3(h.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(v.theta,v.phi,e),this.dollyTo(v.radius,e),this.zoomTo(i.zoom,e),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version","2.10.0"),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,i){let s=e.lengthSq();if(0===s)return t;let r=l.copy(e).add(t),a=this._boundary.clampPoint(r,_).sub(r),o=a.lengthSq();if(0===o)return t.add(e);if(o===s)return t;if(0===i)return t.add(e).add(a);{let s=1+i*o/e.dot(a);return t.add(l.copy(e).multiplyScalar(s)).add(a.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(F(this._camera)){let t=this._camera,e=t.near,i=Math.tan(.5*(t.getEffectiveFOV()*N))*e,s=i*t.aspect;this._nearPlaneCorners[0].set(-s,-i,0),this._nearPlaneCorners[1].set(s,-i,0),this._nearPlaneCorners[2].set(s,i,0),this._nearPlaneCorners[3].set(-s,i,0)}else if(z(this._camera)){let t=this._camera,e=1/t.zoom,i=t.left*e,s=t.right*e,r=t.top*e,a=t.bottom*e;this._nearPlaneCorners[0].set(i,r,0),this._nearPlaneCorners[1].set(s,r,0),this._nearPlaneCorners[2].set(s,a,0),this._nearPlaneCorners[3].set(i,a,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||Q(this._camera,"_collisionTest"))return t;let e=this._getTargetDirection(c);C.lookAt(r,e,this._camera.up);for(let i=0;i<4;i++){let s=l.copy(this._nearPlaneCorners[i]);s.applyMatrix4(C);let r=_.addVectors(this._target,s);U.set(r,e),U.far=this._spherical.radius+1;let a=U.intersectObjects(this.colliderMeshes);0!==a.length&&a[0].distance<t&&(t=a[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;let e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{let e=()=>{this.removeEventListener("rest",e),t()};this.addEventListener("rest",e)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new s.Sphere){let i=e.center;g.makeEmpty(),t.traverseVisible(t=>{t.isMesh&&g.expandByObject(t)}),g.getCenter(i);let r=0;return t.traverseVisible(t=>{if(!t.isMesh||!t.geometry)return;let e=t.geometry.clone();e.applyMatrix4(t.matrixWorld);let s=e.attributes.position;for(let t=0,e=s.count;t<e;t++)h.fromBufferAttribute(s,t),r=Math.max(r,i.distanceToSquared(h))}),e.radius=Math.sqrt(r),e}}let J=(0,L.forwardRef)((t,e)=>{(0,L.useMemo)(()=>{let t={Box3:A.NRn,MathUtils:{clamp:A.cj9.clamp},Matrix4:A.kn4,Quaternion:A.PTz,Raycaster:A.tBo,Sphere:A.iyt,Spherical:A.YHV,Vector2:A.I9Y,Vector3:A.Pq0,Vector4:A.IUQ};G.install({THREE:t}),(0,R.e)({CameraControlsImpl:G})},[]);let{camera:i,domElement:s,makeDefault:r,onStart:a,onEnd:o,onChange:n,regress:h,...l}=t,_=(0,R.A)(t=>t.camera),c=(0,R.A)(t=>t.gl),d=(0,R.A)(t=>t.invalidate),m=(0,R.A)(t=>t.events),u=(0,R.A)(t=>t.setEvents),p=(0,R.A)(t=>t.set),f=(0,R.A)(t=>t.get),v=(0,R.A)(t=>t.performance),T=i||_,g=s||m.connected||c.domElement,E=(0,L.useMemo)(()=>new G(T),[T]);return(0,R.C)((t,e)=>{E.enabled&&E.update(e)},-1),(0,L.useEffect)(()=>(E.connect(g),()=>void E.disconnect()),[g,E]),(0,L.useEffect)(()=>{let t=t=>{d(),h&&v.regress(),n&&n(t)},e=t=>{a&&a(t)},i=t=>{o&&o(t)};return E.addEventListener("update",t),E.addEventListener("controlstart",e),E.addEventListener("controlend",i),E.addEventListener("control",t),E.addEventListener("transitionstart",t),E.addEventListener("wake",t),()=>{E.removeEventListener("update",t),E.removeEventListener("controlstart",e),E.removeEventListener("controlend",i),E.removeEventListener("control",t),E.removeEventListener("transitionstart",t),E.removeEventListener("wake",t)}},[E,a,o,d,u,h,n]),(0,L.useEffect)(()=>{if(r){let t=f().controls;return p({controls:E}),()=>p({controls:t})}},[r,E]),L.createElement("primitive",(0,S.A)({ref:e,object:E},l))})}}]);